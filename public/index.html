<!DOCTYPE html>
<html lang="en">
<head>
    <meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
    <title>Кто торчит</title>
    <link rel="stylesheet" href="dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="dist/css/bootstrap-theme.min.css">
    <script src="dist/js/jquery.min.js" type="text/javascript"></script>
    <script src="dist/js/bootstrap.min.js" type="text/javascript"></script>
    <script src="dist/js/underscore.js" type="text/javascript"></script>

    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">

</head>
<body>
<nav class="navbar navbar-inverse" role="navigation">
    <div class="container-fluid">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar-links">
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="#">Кто торчит?</a>
        </div>

        <div class="collapse navbar-collapse" id="navbar-links">
            <ul class="nav navbar-nav">
                <li><a href="#" data-page="login">Войти</a></li>
                <li><a href="#" data-page="profile">Профиль</a></li>
                <li><a href="#" data-page="users">Пользователи</a></li>
                <li><a href="#" data-page="debtors">Должники</a></li>
                <li><a href="#" data-page="creditors">Кредиторы</a></li>
            </ul>
        </div>
    </div>
</nav>
    <div class="container-fluid" id="wrap"></div>

    <script type="text/template" id="login-template">
        <% if (!data.me) { %>
        <h3>Укажите ваш e-mail</h3>
        <form class="form-inline" role="form" id="sign-in-form">
            <div class="form-group">
                <div class="input-group">
                    <label class="sr-only" for="exampleInputEmail2">Email address</label>
                    <div class="input-group-addon">@</div>
                    <input type="email" class="form-control" id="exampleInputEmail2" placeholder="Enter email">
                </div>
            </div>
            <button type="submit" class="btn btn-default">Войти</button>
        </form>
        <% } else { %>
            <div class="bg-danger">
                Вы уже вошли как <%=data.me.name%>. <a href="#" id="logout-btn">Выйти?</a>
            </div>
        <% } %>
    </script>

    <script type="text/template" id="users-template">
        <table class="table table-striped">
            <% for (var i in data) { %>
            <tr>
                <td class="user-item" data-id="<%= data[i].id%>"><%= data[i].name%> <span class="glyphicon glyphicon-chevron-right"></span></td>
            </tr>
            <% } %>
        </table>
    </script>

    <script type="text/template" id="addTransaction-template">
        <form role="form" id="addTransaction-form">
            <div class="form-group">
                <label>От кого</label>
                <%= data.from.name %>
            </div>
            <div class="form-group">
                <label>Кому</label>
                <%= data.to.name %>
            </div>
            <div class="form-group">
                <label for="label-sum">Сумма</label>
                <input type="number" name="sum" class="form-control" id="label-sum" placeholder="0">
            </div>
            <input type="hidden" name="from" value="<%= data.from.id%>" />
            <input type="hidden" name="to" value="<%= data.to.id%>" />
            <button type="submit" class="btn btn-default">Отправить</button>
        </form>
    </script>

    <script type="text/template" id="profile-template">
        <div>Вы должны: <%= data.our%></div>
        <div>Вам должны: <%= data.my%></div>
    </script>

    <script type="text/template" id="debtors-template">
        <table class="table table-striped">
            <thead>
            <tr>
                <th>Имя</th>
                <th>Сумма</th>
                <th>Статус</th>
            </tr>
            </thead>
            <tbody>
            <% for (var i in data.items) { %>
            <tr>
                <td class="debtors-item" data-id="<%= data.items[i].to%>"><%= data.getUserById(data.items[i].to).name%></td>
                <td><%= data.items[i].amount%> руб.</td>
                <td>
                    <span class="label label-default"><%=data.states[data.items[i].status]%></span>
                    <% if (data.items[i].status == 'paid') { %>
                        <button type="button" class="btn btn-xs btn-success  js-change-state" data-new-state="confirmed" data-id="<%=data.items[i]._id%>">Долг вернули</button>
                        <button type="button" class="btn btn-xs btn-danger  js-change-state" data-new-state="notConfirmed" data-id="<%=data.items[i]._id%>">Это гон</button>
                    <% } else if (data.items[i].status == 'declined') {%>
                    <button type="button" class="btn btn-xs btn-info js-change-state" data-new-state="open" data-id="<%=data.items[i]._id%>">Открыть снова</button>
                    <button type="button" class="btn btn-xs btn-danger js-change-state" data-new-state="closed" data-id="<%=data.items[i]._id%>">Закрыть</button>
                    <% } else if (data.items[i].status == 'confirmed') {%>
                        <button type="button" class="btn btn-xs btn-danger js-change-state" data-new-state="closed" data-id="<%=data.items[i]._id%>">Закрыть</button>
                    <% } %>
                </td>
            </tr>
            <% } %>
            </tbody>
        </table>
    </script>

    <script type="text/template" id="creditors-template">
        <table class="table table-striped">
            <thead>
            <tr>
                <th>Имя</th>
                <th>Сумма</th>
                <th>Статус</th>
            </tr>
            </thead>
            <tbody>
            <% for (var i in data.items) { %>
            <tr>
                <td class="user-item" data-id="<%= data.items[i].from%>"><%= data.getUserById(data.items[i].from).name%></td>
                <td><%= data.items[i].amount%> руб.</td>
                <td>
                    <span class="label label-default"><%=data.states[data.items[i].status]%></span>
                    <% if (data.items[i].status == 'open') { %>
                        <button type="button" class="btn btn-xs btn-success js-change-state" data-new-state="accepted" data-id="<%=data.items[i]._id%>">Деньги получил</button>
                        <button type="button" class="btn btn-xs btn-danger  js-change-state" data-new-state="declined" data-id="<%=data.items[i]._id%>">Мне ничего не давали</button>
                    <% } else if (data.items[i].status == 'accepted' || data.items[i].status == 'notConfirmed') {%>
                        <button type="button" class="btn btn-xs btn-success js-change-state" data-new-state="paid" data-id="<%=data.items[i]._id%>">Деньги вернул</button>
                    <% } %>
                </td>
            </tr>
            <% } %>
            </tbody>
        </table>
    </script>

<script type="text/javascript" src="app.js"></script>
<script type="text/javascript">
    var app = new Application();
    app.init(function() {
        if (app.me)
            app.showPage('users');
        else
            app.showPage('login');
    });
</script>
</body>
</html>